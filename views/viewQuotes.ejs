<!DOCTYPE html>
<html>
<head>
  <title>View Quotes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
  <style>
    body {
      background-color: #1c1c2b;
      color: aliceblue;
    }
    .table td, .table th {
      vertical-align: middle;
    }
    .list-group-item a {
      text-decoration: none;
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4">View Quotes (All Salespeople)</h2>

  <% if (!selectedName) { %>
    <h4>Select a Salesperson:</h4>
    <ul class="list-group">
      <% quotes.forEach(quote => { %>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <a 
            href="/viewQuotes?name=<%= encodeURIComponent(quote.name) %>" 
            class="<%= quote.is_allowed === 0 ? 'text-danger fw-bold' : '' %>"
          >
            <%= quote.name %>
          </a>
          <% if (quote.is_allowed === 0) { %>
            <span class="badge bg-danger">Removed</span>
          <% } %>
        </li>
      <% }) %>
    </ul>

  <% } else { %>
    <h4 class="mb-3">Quotes for <%= selectedName %></h4>

    <% if (quotes.length > 0) { %>
      <table class="table table-bordered table-striped bg-white text-dark">
        <thead class="table-dark">
          <tr>
            <th>Reference</th>
            <th>Customer Name</th>
            <th>Customer Email</th>
            <th>Customer Cell</th>
            <th>Job Description</th>
          </tr>
        </thead>
        <tbody>
          <% quotes.forEach(quote => { %>
            <tr>
              <td><%= quote.reference %></td>
              <td><%= quote.customerName %></td>
              <td><%= quote.customerEmail %></td>
              <td><%= quote.customerCell %></td>
              <td><%= quote.jobDescription %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p>No quotes found for this salesperson.</p>
    <% } %>

    <% if (isRemoved) { %>
      <h4 class="mt-4">Items for <%= selectedName %>'s Customers</h4>
      <% if (Object.keys(items).length > 0) { %>
        <% Object.keys(items).forEach(reference => { %>
          <h5 class="mt-3">Reference: <span class="text-info"><%= reference %></span></h5>
          <table class="table table-bordered table-striped bg-white text-dark">
            <thead class="table-dark">
              <tr>
                <th>Stock Code</th>
                <th>Description</th>
                <th>Qty</th>
                <th>Product Type</th>
                <th>Unit Cost</th>
                <th>Supplier</th>
              </tr>
            </thead>
            <tbody>
              <% items[reference].forEach(item => { %>
                <tr>
                  <td><%= item.stock_code %></td>
                  <td><%= item.description %></td>
                  <td><%= item.qty %></td>
                  <td><%= item.product_type %></td>
                  <td>R<%= item.unit_cost %></td>
                  <td><%= item.supply %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% }) %>
      <% } else { %>
        <p>No items found for this salesperson’s customers.</p>
      <% } %>
    <% } %>

    <a href="/viewQuotes" class="btn btn-secondary mt-3">← Back to Salespeople</a>
  <% } %>

  <a href="/login" class="btn btn-outline-light ms-2 mt-3">Back to Login</a>
</div>
</body>
</html>
