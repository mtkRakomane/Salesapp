<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bill Summary</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    table, th, td {
      border: 1px solid #000;
      font-size: 11px;
    }
    th {
      background-color: #f2f2f2;
    }
    table {
      width: 100%;
      margin-top: 20px;
    }
  </style>
</head>
<body>
    <%
    function formatAccounting(amount) {
        let num = parseFloat(amount || 0);
        const isNegative = num < 0;
        const formatted = Math.abs(num).toLocaleString('en-ZA', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        }).replace(/,/g, ' ');
        return isNegative ? `R (${formatted})` : `R ${formatted}`;
    }
%>
  <div class="container">
    <h2>Bill Summary</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>DESCRIPTION</th>
          <th>TOTAL</th>
        </tr>
      </thead>
      <tbody>
        <% billSummaryData.bills.forEach((bill, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td>Bill <%= index + 1 %>: <%= bill.bill %></td>
            <td><%= formatAccounting(bill.bill_tot_selling) %></td>
          </tr>
        <% }); %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2"><strong>Total (Excl. VAT)</strong></td>
          <td><strong><%= formatAccounting(billSummaryData.totalSellingSum) %></strong></td>
        </tr>
        <tr>
          <td colspan="2"><strong>VAT (15%)</strong></td>
          <td><strong><%= formatAccounting(billSummaryData.vatAmountForAll) %></strong></td>
        </tr>
        <tr>
          <td colspan="2"><strong>Total (Incl. VAT)</strong></td>
          <td><strong><%= formatAccounting(billSummaryData.totalWithVat) %></strong></td>
        </tr>
      </tfoot>
    </table>
    <a href="/billing" class="btn btn-secondary mt-3">Back to Billing</a>
  </div>
</body>
</html>
